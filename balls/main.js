(()=>{"use strict";const t=function(){function t(t,e){var r=this;this._contains=null,this._position=t,this.ref=document.createElement("div"),this.ref.classList.add("cell"),this._hoverHandler=e,this.ref.addEventListener("mouseenter",(function(){r.onHover()})),this.ref.addEventListener("click",(function(){var t;return null===(t=r._contains)||void 0===t?void 0:t.onSelect()}))}return t.prototype.onHover=function(){this._hoverHandler(this)},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contains",{get:function(){return this._contains},enumerable:!1,configurable:!0}),t.prototype.empty=function(){this._contains=null},t.prototype.popBall=function(){var t;null===(t=this._contains)||void 0===t||t.pop(),this._contains=null},t.prototype.placeBall=function(t){this.ref.appendChild(t.ref),t.move(this.position),this._contains=t},t.prototype.mark=function(){this.ref.style.background="#444"},t.prototype.unmark=function(){this.ref.style.background=""},t.prototype.darken=function(){this.ref.style.background="#ddd"},t}();var e;!function(t){t.Red="#ff0000",t.Green="#00ff00",t.Blue="#0000ff",t.Orange="#ffa500",t.Black="#000000",t.Purple="#800080",t.Brown="#964b00"}(e||(e={}));const r=function(){function t(t,e,r){this._animationDuration=.5,this._selected=!1,this._position=t,this._selectHandler=r,this._color=e,this.ref=document.createElement("div"),this.ref.classList.add("ball"),this.ref.style.backgroundColor=this._color}return Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.ref.style.backgroundColor=this._color},enumerable:!1,configurable:!0}),t.prototype.onSelect=function(){this.selected?this.deSelect():this.select(),this._selectHandler(this)},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},enumerable:!1,configurable:!0}),t.prototype.move=function(t){this._position=t},t.prototype.select=function(){this._selected=!0,this.ref.style.transform="scale(1.5)"},t.prototype.deSelect=function(){this._selected=!1,this.ref.style.transform=""},t.prototype.pop=function(){var t=this;this.ref.style.animationName="pop",this.ref.style.animationDuration=this._animationDuration+"s",setTimeout((function(){t.ref.remove()}),1e3*this._animationDuration)},t}(),n=function(){function t(){this._nextColors=[],this._score=0,this.ballsRef=document.querySelector(".balls"),this.scoreRef=document.querySelector(".points")}return t.prototype.randomColors=function(t){this.colors.splice(0);for(var r=0;r<t;r++){var n=Object.values(e);this._nextColors.push(n[Math.floor(Math.random()*n.length)])}this.renderPreview()},t.prototype.renderPreview=function(){this.ballsRef.innerHTML="";var t=document.createDocumentFragment();this._nextColors.forEach((function(e){var r=document.createElement("div");r.classList.add("ball"),r.style.background=e,t.appendChild(r)})),this.ballsRef.appendChild(t)},Object.defineProperty(t.prototype,"colors",{get:function(){return this._nextColors},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(t){this._score=t,this.scoreRef.innerHTML=t.toString()},enumerable:!1,configurable:!0}),t}();var o=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s},i=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},s=function(){function t(){this.gValue=0}return Object.defineProperty(t.prototype,"value",{get:function(){return this.gValue+this.hValue},enumerable:!1,configurable:!0}),t}();new(function(){function e(e,r,i){var s=this;void 0===i&&(i=3),this._balls=[],this._targetCell=null,this._selectedBall=null,this._size=e,this._ballsPerRound=r,this._combo=i,this._ref=document.createElement("div"),this._ref.classList.add("grid"),document.body.appendChild(this._ref);var l=o(e,2),a=l[0],c=l[1];this._cells=[];for(var h=document.createDocumentFragment(),u=0;u<a;u++){this._cells[u]=[];for(var f=0;f<c;f++)this._cells[u][f]=new t([u,f],(function(t){return s.handleHover(t)})),h.appendChild(this._cells[u][f].ref)}this._ref.appendChild(h),this._ref.addEventListener("click",(function(){return s.handleClick()})),this._stats=new n,this.generateBalls()}return Object.defineProperty(e.prototype,"balls",{get:function(){return this._balls},enumerable:!1,configurable:!0}),e.prototype.handleClick=function(){if(this._selectedBall&&this._targetCell){var t=o(this._selectedBall.position,2),e=t[0],r=t[1];this._cells[e][r].empty(),this._targetCell.placeBall(this._selectedBall),this.popBalls(this._targetCell.position),this._targetCell=null,this._selectedBall.deSelect(),this._selectedBall=null,this.darkenMarks(),this.generateBalls()}},e.prototype.handleSelect=function(t){0!=this.getNeighbors(t.position).length?(this._selectedBall&&this._selectedBall.deSelect(),this._selectedBall=t.selected?t:null):t.deSelect()},e.prototype.handleHover=function(t){if(this._selectedBall){var e=this.findPath(t);if(!t.contains&&!e)return void(t.ref.style.cursor="default");this._selectedBall==t.contains&&this.getNeighbors(t.position).length>0&&(t.ref.style.cursor="default"),t.ref.style.cursor="pointer"}else t.contains&&this.getNeighbors(t.position).length>0?t.ref.style.cursor="pointer":t.ref.style.cursor="default"},e.prototype.generateBalls=function(){var t=this;if(this._balls.length+this._ballsPerRound>=this._size[0]*this._size[1])this.gameOver();else{0==this._stats.colors.length&&this._stats.randomColors(this._ballsPerRound);var e=[];this._stats.colors.map((function(n){var i,s,l=o(t._size,2),a=l[0],c=l[1];do{i=Math.floor(Math.random()*a),s=Math.floor(Math.random()*c)}while(null!==t._cells[i][s].contains);e.push([i,s]);var h=new r([i,s],n,(function(e){return t.handleSelect(e)}));t._balls.push(h),t._cells[i][s].placeBall(h)})),this._stats.randomColors(this._ballsPerRound),e.forEach((function(e){return t.popBalls(e)}))}},e.prototype.findPath=function(t){this._currentPath=[];var e=this._selectedBall.position,r=t.position;if(this._cells[r[0]][r[1]].contains)return this._targetCell=null,this.clearMarks(),!1;for(var n=this._cells.map((function(t){return t.map((function(){return new s}))})),i=e,l=[],a=function(){c.getNeighbors(i,n).forEach((function(t){var e=o(t,2),s=e[0],a=e[1];n[s][a].gValue=n[i[0]][i[1]].gValue+1,n[s][a].hValue=Math.abs(r[0]-s)+Math.abs(r[1]-a),n[s][a].parent=i,l.push([s,a])}));var t,e=l[0];if(l.length<=0)return c._targetCell=null,c.clearMarks(),{value:!1};l.forEach((function(r,i){var s=o(r,2),l=s[0],a=s[1];n[l][a].value<n[e[0]][e[1]].value&&(e=[l,a],t=i)})),l.splice(t,1),i=e},c=this;i[0]!=r[0]||i[1]!=r[1];){var h=a();if("object"==typeof h)return h.value}var u=o(i,2),f=u[0],p=u[1];return this._targetCell=this._cells[f][p],this.reconstructPath(i,n),!0},e.prototype.getNeighbors=function(t,e){var r=this;void 0===e&&(e=null);for(var n=o(this._size,2),i=n[0],s=n[1],l=[],a=-1;a<=1;a+=2){var c=t[0]+a,h=t[1];c>=0&&c<i&&h>=0&&h<s&&l.push([c,h]),c=t[0],h=t[1]+a,c>=0&&c<i&&h>=0&&h<s&&l.push([c,h])}return l=l.filter((function(t){var n=o(t,2),i=n[0],s=n[1];return!r._cells[i][s].contains&&(!e||!e[i][s].parent||void 0)})),l},e.prototype.reconstructPath=function(t,e){this.clearMarks();for(var r=t;e[r[0]][r[1]].parent;){var n=o(r,2),i=n[0],s=n[1];this._cells[i][s].mark(),this._currentPath.push(r),r=e[i][s].parent}this._currentPath.push(r),this._cells[r[0]][r[1]].mark()},e.prototype.darkenMarks=function(){var t=this;this._currentPath.forEach((function(e){var r=o(e,2),n=r[0],i=r[1];t._cells[n][i].darken()}))},e.prototype.clearMarks=function(){this._cells.forEach((function(t){return t.forEach((function(t){t.unmark()}))}))},e.prototype.popBalls=function(t){for(var e=this,r=function(t){var r,n=0,i=[];return t.forEach((function(t){var s,l=o(t,2),a=l[0],c=l[1],h=e._cells[a][c];h.contains&&h.contains.color===r||(i.length-n>=e._combo&&(n=i.length),i.splice(n),r=null===(s=h.contains)||void 0===s?void 0:s.color),i.push([a,c])})),i.length-n<e._combo&&i.splice(n),i.map((function(t){var r=o(t,2),n=r[0],i=r[1];return e._cells[n][i].contains}))},n=[],s=[],l=[],a=[],c=0;c<this._size[1];c++)n.push([t[0],c]);for(var h=0;h<this._size[0];h++)s.push([h,t[1]]);for(var u=Math.abs(t[0]-t[1]),f=0;f+u<this._size[0]&&f+u<this._size[1];f++){var p=void 0;p=t[0]>t[1]?[f+u,f]:[f,f+u],l.push(p)}var d=t[0]+t[1],_=d-(this._size[0]-1),v=0;for(v=_<0?0:_;d-v>=0&&v<this._size[0];v++)p=void 0,a.push([v,d-v]);var y=i([],o(new Set(i(i(i(i([],o(r(n)),!1),o(r(s)),!1),o(r(l)),!1),o(r(a)),!1))),!1);this._balls=this._balls.filter((function(t){return-1==y.indexOf(t)})),y.forEach((function(t){var r=o(t.position,2),n=r[0],i=r[1];e._cells[n][i].popBall()})),this._stats.score+=y.length},e.prototype.gameOver=function(){this._ref.classList.remove("grid"),this._ref.classList.add("result"),this._ref.innerHTML="\n            Your score: "+this._stats.score+"\n        "},e}())([9,9],3,5)})();